package friends

import "github.com/hekigan/couples/internal/services"

// FriendsList renders the list of friends with invite buttons
templ FriendsList(data *services.FriendsListData) {
	if len(data.Friends) > 0 {
		<ul role="list" style="list-style: none; padding: 0; margin: 0;">
			for _, friend := range data.Friends {
				<li class="friend-item" id={ "friend-" + friend.ID }>
					<div class="friend-info">
						<span class="friend-name">{ friend.Username }</span>
					</div>
					<button
						hx-post="/api/v1/rooms/invitations"
						hx-vals={ `{"room_id": "` + data.RoomID + `", "invitee_id": "` + friend.ID + `"}` }
						hx-target={ "#friend-" + friend.ID }
						hx-swap="outerHTML"
						hx-disabled-elt="this"
						hx-indicator={ "#invite-loading-" + friend.ID }
						hx-on::after-request="
							if(!event.detail.successful) {
								const errorMsg = document.createElement('span');
								errorMsg.textContent = 'âŒ Failed to invite';
								errorMsg.style.cssText = 'color: #ef4444; font-size: 0.75rem; margin-left: 0.5rem;';
								this.parentElement.appendChild(errorMsg);
								setTimeout(() => errorMsg.remove(), 3000);
							}
						"
						aria-label={ "Invite " + friend.Username + " to join your room" }
						class="btn btn-primary btn-sm"
					>
						<span>ğŸ“§ Invite</span>
						<span id={ "invite-loading-" + friend.ID } class="htmx-indicator" style="margin-left: 0.25rem; font-size: 0.75rem;">â³</span>
					</button>
				</li>
			}
		</ul>
	} else {
		<p role="status" class="loading-text">No friends yet. <a href="/friends" aria-label="Go to friends page to add friends">Add friends</a></p>
	}
}
