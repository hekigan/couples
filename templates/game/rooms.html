{{define "content"}}
<div class="container">
    <div class="page-header">
        <h1>ğŸ’• My Rooms</h1>
        <a href="/game/create-room" role="button">+ Create New Room</a>
    </div>

    {{if .Data}}
        <div class="rooms-grid">
            {{range .Data}}
            <div class="room-card" id="room-{{.ID}}">
                <div class="room-card-header">
                    <span class="room-id">ğŸ†” {{.ID}}</span>
                    <span class="room-status room-status-{{.Status}}">{{.Status}}</span>
                </div>
                <div class="room-card-body">
                    <p class="room-info">
                        <span class="room-info-label">Playing with:</span>
                        <span class="room-info-value">
                            {{if .OtherPlayerUsername}}
                                ğŸ‘¤ {{.OtherPlayerUsername}}
                            {{else}}
                                â³ Waiting for player...
                            {{end}}
                        </span>
                    </p>
                    <p class="room-info">
                        <span class="room-info-label">Language:</span>
                        <span class="room-info-value">{{if .Language}}{{.Language}}{{else}}en{{end}}</span>
                    </p>
                    <p class="room-info">
                        <span class="room-info-label">Status:</span>
                        <span class="room-info-value">
                            {{if eq .Status "ready"}}âœ… Ready to play
                            {{else if eq .Status "playing"}}ğŸ® Playing
                            {{else}}â³ Waiting for guest{{end}}
                        </span>
                    </p>
                    <p class="room-info">
                        <span class="room-info-label">Created:</span>
                        <span class="room-info-value">{{.CreatedAt.Format "Jan 2, 2006"}}</span>
                    </p>
                </div>
                <div class="room-card-actions">
                    {{if eq .Status "waiting"}}
                        <a href="/game/room/{{.ID}}" role="button">Enter Room</a>
                    {{else if eq .Status "ready"}}
                        <a href="/game/room/{{.ID}}" role="button" class="btn-success">Enter Room</a>
                    {{else if eq .Status "playing"}}
                        <a href="/game/play/{{.ID}}" role="button" class="btn-success">Continue Game</a>
                    {{else if eq .Status "finished"}}
                        <a href="/game/finished/{{.ID}}" role="button" class="secondary">View Results</a>
                    {{end}}
                    {{if .IsOwner}}
                        <button type="button"
                                class="btn-danger"
                                hx-delete="/api/rooms/{{.ID}}"
                                hx-confirm="âš ï¸ Are you sure you want to delete this room?\n\nThis action cannot be undone and will remove all game data."
                                hx-target="#room-{{.ID}}"
                                hx-swap="outerHTML swap:300ms"
                                hx-disabled-elt="this"
                                aria-label="Delete room">
                            Delete
                        </button>
                    {{else}}
                        <button type="button"
                                class="secondary"
                                hx-post="/api/rooms/{{.ID}}/leave"
                                hx-confirm="âš ï¸ Are you sure you want to leave this room?\n\nThe room will remain for the owner, but you will be removed."
                                hx-target="#room-{{.ID}}"
                                hx-swap="outerHTML swap:300ms"
                                hx-disabled-elt="this"
                                aria-label="Leave room">
                            Leave
                        </button>
                    {{end}}
                </div>
            </div>
            {{end}}
        </div>
    {{else}}
        <div class="empty-state">
            <p class="empty-state-icon">ğŸ®</p>
            <h2>No Rooms Yet</h2>
            <p>Create your first room to start playing!</p>
            <a href="/game/create-room" role="button">Create Room</a>
        </div>
    {{end}}
</div>

<script>
// ============================================================================
// HTMX now handles:
// - Room deletion via hx-delete="/api/rooms/{id}"
// - Room leave via hx-post="/api/rooms/{id}/leave"
// - Confirmation dialogs via hx-confirm attribute
// - Fade-out animations via hx-swap="outerHTML swap:300ms"
// - Button disable during requests via hx-disabled-elt
// ============================================================================

// Check if grid is empty after deletions and reload to show empty state
document.body.addEventListener('htmx:afterSwap', function(event) {
    const roomsGrid = document.querySelector('.rooms-grid');
    if (roomsGrid && roomsGrid.children.length === 0) {
        // Show empty state by reloading
        setTimeout(() => window.location.reload(), 300);
    }
});
</script>
{{end}}

