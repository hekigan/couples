{{range .}}
<div class="request-card" id="request-{{.RoomID}}">
    <div class="request-info">
        <strong>Room: {{.RoomID}}</strong>
        {{if .Message}}
        <p class="request-message">{{.Message}}</p>
        {{end}}

        {{if eq .Status "pending"}}
        <span class="request-status pending" role="status" aria-live="polite">⏳ Request sent, waiting for approval...</span>
        {{else if eq .Status "accepted"}}
        <span class="request-status accepted" role="status" aria-live="polite">✅ Request accepted!</span>
        <a href="/game/room/{{.RoomID}}"
           class="btn btn-success btn-sm"
           style="margin-top: 1rem; display: inline-block; padding: 0.5rem 1rem; background: #10b981; color: white; text-decoration: none; border-radius: 6px; font-weight: 600;"
           aria-label="Go to room {{.RoomID}}">
            Go to Room →
        </a>
        {{else if eq .Status "rejected"}}
        <span class="request-status rejected" role="status" aria-live="assertive">❌ Request rejected by owner</span>
        <p style="color: #6b7280; font-size: 0.875rem; margin-top: 0.5rem;">
            The room owner declined your request.
        </p>
        {{end}}
    </div>

    {{if eq .Status "pending"}}
    <button hx-post="/api/rooms/{{.RoomID}}/cancel-my-request"
            hx-target="#request-{{.RoomID}}"
            hx-swap="outerHTML swap:300ms"
            hx-confirm="⚠️ Cancel this join request?"
            hx-disabled-elt="this"
            hx-indicator="#cancel-loading-{{.RoomID}}"
            hx-on::after-request="
                if(!event.detail.successful) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'error-message';
                    errorDiv.textContent = '❌ Failed to cancel request';
                    errorDiv.style.cssText = 'color: #ef4444; margin-top: 0.5rem; font-size: 0.875rem;';
                    this.parentElement.appendChild(errorDiv);
                    setTimeout(() => errorDiv.remove(), 3000);
                }
            "
            aria-label="Cancel join request for room {{.RoomID}}"
            class="btn-cancel">
        <span>Cancel Request</span>
        <span id="cancel-loading-{{.RoomID}}" class="htmx-indicator" style="margin-left: 0.25rem;">⏳</span>
    </button>
    {{end}}
</div>
{{else}}
<!-- No pending requests -->
{{end}}
