{{if .Categories}}
<fieldset style="border: none; padding: 0; margin: 0;">
    <div class="categories-grid">
        <span class="category-saving htmx-indicator">
            <span>updating...</span>
        </span>
        {{range .Categories}}
        <label class="category-checkbox" for="category-{{.ID}}">
            <input type="checkbox"
                id="category-{{.ID}}"
                name="category_id"
                value="{{.ID}}"
                {{if .IsSelected}}checked{{end}}
                {{if $.GuestReady}}
                disabled
                aria-disabled="true"
                title="Categories locked - guest is ready"
                {{end}}
                hx-post="/api/rooms/{{$.RoomID}}/categories/toggle"
                hx-vals='{"category_id": "{{.ID}}"}'
                hx-trigger="change"
                hx-swap="none"
                hx-disabled-elt="this"
                hx-indicator=".category-saving"
                hx-on::after-request="
                    if(!event.detail.successful) {
                        this.checked = !this.checked;
                        this.parentElement.classList.add('error');
                        this.setAttribute('aria-invalid', 'true');
                        setTimeout(() => {
                            this.parentElement.classList.remove('error');
                            this.removeAttribute('aria-invalid');
                        }, 2000);
                    } else {
                        this.parentElement.classList.add('saved');
                        setTimeout(() => this.parentElement.classList.remove('saved'), 300);
                    }
                "
                aria-label="{{.Label}} category"/>
            <span class="category-label">{{.Label}}</span>
        </label>
        {{end}}
    </div>
</fieldset>
{{else}}
    <p role="status" class="loading-text">No categories available</p>
{{end}}
