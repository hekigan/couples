{{define "content"}}
<div class="container" style="max-width: 500px; margin: 4rem auto; padding: 2rem;">
    <div class="card" style="background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 2rem;">
        <h1 style="text-align: center; margin-bottom: 0.5rem;">ðŸ‘‹ Welcome!</h1>
        <p style="text-align: center; color: #6b7280; margin-bottom: 2rem;">Choose a username to get started</p>
        
        <form method="POST" action="/setup-username" id="username-form">
            <div class="form-group" style="margin-bottom: 1rem;">
                <label for="username" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Username</label>
                <input 
                    type="text" 
                    id="username" 
                    name="username" 
                    required 
                    minlength="3"
                    maxlength="20"
                    pattern="[a-zA-Z0-9_]+"
                    placeholder="e.g., player123"
                    style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;"
                    autocomplete="off"
                >
                <small style="display: block; margin-top: 0.5rem; color: #6b7280;">
                    3-20 characters, letters, numbers and underscore only
                </small>
            </div>
            
            <div id="error-message" style="display: none; padding: 0.75rem; background: #fee; border-left: 4px solid #ef4444; border-radius: 4px; margin-bottom: 1rem; color: #dc2626;"></div>
            
            <button 
                type="submit" 
                class="btn btn-primary" 
                style="width: 100%; padding: 0.875rem; background: #3b82f6; color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer;"
            >
                Continue
            </button>
        </form>
    </div>
</div>

<style>
.btn-primary:hover {
    background: #2563eb;
}

input:focus {
    outline: none;
    border-color: #3b82f6;
}

input:invalid {
    border-color: #ef4444;
}
</style>

<script>
document.getElementById('username-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const username = document.getElementById('username').value;
    const errorDiv = document.getElementById('error-message');
    
    try {
        const response = await fetch('/setup-username', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `username=${encodeURIComponent(username)}`
        });
        
        if (response.ok) {
            window.location.href = '/';
        } else {
            const data = await response.text();
            errorDiv.textContent = data || 'Username already taken or invalid';
            errorDiv.style.display = 'block';
        }
    } catch (error) {
        errorDiv.textContent = 'An error occurred. Please try again.';
        errorDiv.style.display = 'block';
    }
});
</script>
{{end}}

